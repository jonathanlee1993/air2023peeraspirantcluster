---
title: 'AIR Forum 2023: Integrating Cluster Analysis to Select Peer and Aspirant Comparison Groups'
author: "University of West Florida Institutional Research"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## Introduction

In this document, we will demonstrate the process of performing a cluster analysis on IPEDS data. Using this document as a guide, your office should also be able to perform a cluster analysis using R. To run this analysis, we will use the most up to date IPEDS data available in the IPEDS Data Center as of the drafting of the document (June 2023), labeling this data `ipeds_data_tbl`. Examples shown in this document will use our data file, but the user is free to use any IPEDS data or perhaps data from other locations to run their analyses.

The main objective of this analysis is to identify peer and aspirant comparison groups. Clustering is a powerful unsupervised learning technique that allows us to identify structure in our data. For our purposes, we will use the K-means clustering algorithm.

```{r echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(tidyverse)

ipeds_data_tbl <- read.csv(
  "F:/Work Stuff/air2023peeraspirantcluster/dclust_vars_tbl.rds"
) %>% 
  as_tibble()
```

## Load Required Packages

First, we need to load the required packages for our analysis:

- `tidyverse`: Collection of packages for data manipulation and visualization.
- `ggplot2`: Powerful tool for creating professional plots. Note: `ggplot2` is also part of `tidyverse`.
- `ggbiplot`: An extension of `ggplot2` for creating biplots.
- `recipes`: A package for pre-processing your data before analysis.
- `factoextra`: Simplifies the extraction and visualization of the output of exploratory data analysis.

The `ggbiplot` package is not hosted on CRAN. You can install it from GitHub using the `devtools` package.

```{r eval=FALSE}
# Install ggbiplot if it's not already installed
if (!require(ggbiplot)) {
  if (!require(devtools)) {
    install.packages("devtools")
    library(devtools)
  }
  devtools::install_github("vqv/ggbiplot")
}
```

Now, we load the packages:

```{r message=FALSE, warning=FALSE, results='hide'}
# Load libraries
library(tidyverse) # for data manipulation and visualization
library(ggplot2) # for creating professional plots
library(ggbiplot) # for creating biplots
library(recipes) # for pre-processing your data
library(factoextra) # for visualizing the output of EDA
```

Please replace the current "Load Required Packages" section in your Rmarkdown document with the above text and code. Remember to run the `devtools::install_github("vqv/ggbiplot")` code to install the `ggbiplot` package if you haven't done so already.

## Load Data

Load the data file. The easiest way to do this is to save the data as a csv and load it into the session using the `read.csv` function and the `as_tibble` function to turn the `data frame` into a `tibble`.

```{r eval=FALSE}
ipeds_data_tbl <- read.csv(
  "[insert file path here].csv"
) %>% 
  as_tibble()
```

## Principal Component Analysis of the Variables

Principal Component Analysis (PCA) is a statistical technique that is used to emphasize variation and bring out strong patterns in a dataset. We use it to transform our original variables into a new set of variables called principal components. The first principal component explains the most variance in the data, the second principal component explains the second most, and so on. PCA helps to simplify the complexity in high-dimensional data while retaining trends and patterns. It does this by transforming the data into fewer dimensions, which can then be visualized.

In this analysis, we're performing PCA to gain insights into the relationships between our variables. PCA will allow us to reduce the dimensionality of our data, making it easier to visualize and interpret.

First, we set the seed to ensure the reproducibility of our results:

```{r}
# Set seed for reproducibility
set.seed(100)
```

Next, we create a table of variable names, renaming them in a var_{} format for better visualization in our biplot:

```{r}
# Create variable table with renamed variables
vars_tbl <- tibble(
  vars_chr    = ipeds_data_tbl %>% 
    select(-c("UnitID", "Institution.Name", "Sector")) %>% 
    colnames(),
  varnums_chr = str_glue("var_{seq_along(vars_chr)}")
)
```

We then apply these new variable names to our data:

```{r}
# Apply new variable names to data
dclust_vars_pca_tbl <- ipeds_data_tbl %>% 
  rename_with(
    function(x) vars_tbl %>% filter(vars_chr == x) %>% pull(varnums_chr),
    -c("UnitID", "Institution.Name", "Sector")
  )
```


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
